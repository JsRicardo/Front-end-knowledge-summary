# TCP三次握手

TCP三次握手是什么？为什么要握手三次？

话说小明和小红还没有成为男女朋友之前，在一起上高中，那时候小明一眼看见小红就喜欢上了。这一天小明终于鼓起勇气想相小红传纸条聊天，但是他们中间隔了几个同学，小明就担心万一自己的字条送不到小红那里怎么办？万一小红回信了，但是自己没收到怎么办？

- 比如，此时小明相当于想要通信的客户端，小红相当于服务器。两台机器之间要相互通信，必须先要确定两台机器需要有收和发的能力，才能建立通信。

于是小明还是写了一张纸条，上书：小红小红，我是小明，我们可以聊天么？纸条序号是249。小纸条也很顺利的送到了小红手中

- 客户端向服务器发送了一条消息，服务器也收到了消息，这时候服务器确定了客户端有发信的能力。第一张纸条也就代表`第一次握手`，这一次主要有两个目的：一是请求建立链接，用`SYN=1`表示；二是传递客户端的序列号，这里是249，也就是`seq=249`

小红收到了纸条之后，也给小明回了一条信息：你好啊，我收到了纸条250，那么我们现在开始聊天么？我纸条的序号是99。然后这张纸条也顺利的到了小明手中

- 这时候，服务端回信给客户端也就是`第二次握手`了。客户端确认了服务器能够接收和发送，服务端也同意建立链接，怎么确认的呢？
- 一是同意建立链接，‘那我们开始聊天么’，发送了`SYN=1`
- 二是确认收到了消息（`ack = 客户端的seq + 1`），服务端收到的序列号为249，将这个序列号加一返回，所以说收到了纸条250，代表收到的确实是这个客户端发送的消息
- 三是发出自己的序列号`seq=99`

此时虽然小明确定了小红能收发信息，小红也知道小明能发送信息，但是小红并不知道小明能不能收到信息。所以小明又给小红写了一张纸条：哈哈哈~ 收到了纸条100，这张纸条是250，现在开始聊天吧！

- 这就是第三次握手，客户端收到了服务端的回信后，又一次发信给服务端，让服务端确认自己能收到信息。这次发信包含三个信息
- 一是`SYN=0`，表示现在开始发送
- 二是确认收到了服务端的信息，发送`ack = 服务端的seq + 1`
- 三是发出这张纸条的序列号，最开始自己的序列号 + 1

经过了这三次传纸条，小明和小红都确定了两人能够正常的收发信息，于是两人开始正常通信了

    小明：苦海无涯，回头是我，我喜欢你呀，小红
    小红：我喜欢吃苦
    小明：55555555555~

![image](https://user-gold-cdn.xitu.io/2020/7/1/173082452333fdc2?w=690&h=441&f=jpeg&s=34762)